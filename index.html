<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bella Brownies - Controle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Parisienne&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-pink: #FADADD;
            --secondary-pink: #FFB6C1;
            --accent-brown: #6B4226;
            --white: #FFFFFF;
            --text-dark: #3D2314;
        }
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--primary-pink);
            color: var(--text-dark);
        }
        .font-parisienne { font-family: 'Parisienne', cursive; }
        .tab-button.active {
            background-color: var(--accent-brown);
            color: var(--white);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .tab-button { transition: all 0.3s ease; }
        .modal { transition: opacity 0.3s ease; }
        .table-header { background-color: var(--secondary-pink); }
        .btn-primary {
            background-color: var(--accent-brown);
            color: var(--white);
            transition: background-color 0.3s ease;
        }
        .btn-primary:hover { background-color: #855a3f; }
        .input-field { border-color: var(--secondary-pink); }
        .input-field:focus {
            border-color: var(--accent-brown);
            outline: none;
            box-shadow: 0 0 0 2px rgba(107, 66, 38, 0.2);
        }
        .bow-logo {
            position: relative;
            display: inline-block;
            font-size: 5rem;
            color: var(--white);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        .bow-svg {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%) rotate(-15deg);
            width: 80px;
            height: 80px;
            fill: var(--secondary-pink);
            filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.2));
        }
        .action-btn {
            cursor: pointer;
            background: none;
            border: none;
            padding: 4px;
            border-radius: 999px;
            transition: background-color 0.2s;
        }
        .action-btn:hover { background-color: rgba(0,0,0,0.1); }
    </style>
</head>
<body class="antialiased">

    <div id="app-content" class="container mx-auto p-4 sm:p-6 lg:p-8">

        <header class="text-center mb-8">
            <div class="relative inline-block">
                 <svg class="bow-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12,2C6.48,2,2,6.48,2,12s4.48,10,10,10s10-4.48,10-10S17.52,2,12,2z M17.5,15.5c-1.04,1.04-2.43,1.62-3.89,1.62 s-2.85-0.58-3.89-1.62C8.68,14.46,8,13.28,8,12c0-1.28,0.68-2.46,1.72-3.5C10.76,7.46,12.15,6.88,13.61,6.88 s2.85,0.58,3.89,1.62c1.04,1.04,1.72,2.22,1.72,3.5C19.22,13.28,18.54,14.46,17.5,15.5z M13.61,8.88c-0.83,0-1.5,0.67-1.5,1.5 s0.67,1.5,1.5,1.5s1.5-0.67,1.5-1.5S14.44,8.88,13.61,8.88z M10.61,11.88c-0.83,0-1.5,0.67-1.5,1.5s0.67,1.5,1.5,1.5 s1.5-0.67,1.5-1.5S11.44,11.88,10.61,11.88z"/></svg>
                <h1 class="font-parisienne bow-logo text-5xl sm:text-6xl md:text-7xl">Bella</h1>
            </div>
            <p class="font-parisienne text-3xl sm:text-4xl md:text-5xl -mt-4 text-white" style="text-shadow: 1px 1px 3px rgba(0,0,0,0.2);">brownies</p>
        </header>

        <div class="flex flex-wrap justify-center gap-2 mb-8">
            <button data-tab="vendas" class="tab-button active px-4 py-2 rounded-lg font-semibold">Vendas</button>
            <button data-tab="estoque" class="tab-button px-4 py-2 rounded-lg font-semibold">Estoque</button>
            <button data-tab="a-prazo" class="tab-button px-4 py-2 rounded-lg font-semibold">A Prazo</button>
            <button data-tab="compras" class="tab-button px-4 py-2 rounded-lg font-semibold">Compras</button>
            <button data-tab="producao" class="tab-button px-4 py-2 rounded-lg font-semibold">Produção</button>
            <button data-tab="financeiro" class="tab-button px-4 py-2 rounded-lg font-semibold">Financeiro</button>
        </div>

        <main id="tab-content" class="bg-white/80 backdrop-blur-sm p-4 sm:p-6 rounded-2xl shadow-lg">
            
            <div id="vendas" class="tab-panel">
                <h2 class="text-2xl font-bold mb-4 text-accent-brown">Registro de Vendas</h2>
                 <div class="overflow-x-auto">
                    <table class="min-w-full bg-white rounded-lg shadow">
                        <thead class="table-header">
                            <tr>
                                <th class="p-3 text-left">Data</th>
                                <th class="p-3 text-left">Cliente</th>
                                <th class="p-3 text-left">Qtd</th>
                                <th class="p-3 text-left">Pgto</th>
                                <th class="p-3 text-left">Total</th>
                                <th class="p-3 text-left">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="vendas-table-body"></tbody>
                    </table>
                </div>
                <button data-modal-target="vendaModal" class="btn-primary mt-4 px-4 py-2 rounded-lg">Adicionar Venda</button>
            </div>

            <div id="estoque" class="tab-panel hidden">
                <h2 class="text-2xl font-bold mb-4 text-accent-brown">Controle de Estoque</h2>
                <div class="bg-white/90 p-6 rounded-lg shadow text-center mb-6">
                    <h3 class="text-lg font-semibold text-accent-brown">Brownies Disponíveis</h3>
                    <p id="estoque-total" class="text-5xl font-bold">0</p>
                </div>
                <h3 class="text-xl font-bold mb-4 text-accent-brown">Produções em Estoque</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white rounded-lg shadow">
                        <thead class="table-header">
                            <tr>
                                <th class="p-3 text-left">Data</th>
                                <th class="p-3 text-left">Nome da Produção</th>
                                <th class="p-3 text-left">Qtd. Disponível</th>
                            </tr>
                        </thead>
                        <tbody id="estoque-table-body"></tbody>
                    </table>
                </div>
            </div>

            <div id="a-prazo" class="tab-panel hidden">
                <h2 class="text-2xl font-bold mb-4 text-accent-brown">Clientes a Prazo</h2>
                 <div class="overflow-x-auto">
                    <table class="min-w-full bg-white rounded-lg shadow">
                        <thead class="table-header">
                            <tr>
                                <th class="p-3 text-left">Cliente</th>
                                <th class="p-3 text-left">Valor Devido</th>
                                </tr>
                        </thead>
                        <tbody id="aprazo-table-body"></tbody>
                    </table>
                </div>
            </div>

            <div id="compras" class="tab-panel hidden">
                <h2 class="text-2xl font-bold mb-4 text-accent-brown">Registro de Compras (Ingredientes)</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white rounded-lg shadow">
                        <thead class="table-header">
                            <tr>
                                <th class="p-3 text-left">Data</th>
                                <th class="p-3 text-left">Produto</th>
                                <th class="p-3 text-left">Custo / Unid.</th>
                                <th class="p-3 text-left">Preço Total</th>
                                <th class="p-3 text-left">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="compras-table-body"></tbody>
                    </table>
                </div>
                <button data-modal-target="compraModal" class="btn-primary mt-4 px-4 py-2 rounded-lg">Adicionar Compra</button>
            </div>

            <div id="producao" class="tab-panel hidden">
                <h2 class="text-2xl font-bold mb-4 text-accent-brown">Controle de Produção</h2>
                 <div class="overflow-x-auto">
                    <table class="min-w-full bg-white rounded-lg shadow">
                        <thead class="table-header">
                            <tr>
                                <th class="p-3 text-left">Data</th>
                                <th class="p-3 text-left">Nome</th>
                                <th class="p-3 text-left">Feitos</th>
                                <th class="p-3 text-left">Custo/Un</th>
                                <th class="p-3 text-left">Venda</th>
                                <th class="p-3 text-left">Perdidos</th>
                                <th class="p-3 text-left">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="producao-table-body"></tbody>
                    </table>
                </div>
                <button data-modal-target="producaoModal" class="btn-primary mt-4 px-4 py-2 rounded-lg">Nova Produção</button>
            </div>

            <div id="financeiro" class="tab-panel hidden">
                <h2 class="text-2xl font-bold mb-4 text-accent-brown">Controle Financeiro</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 text-center">
                    <div class="bg-white/90 p-4 rounded-lg shadow">
                        <h3 class="text-lg font-semibold text-accent-brown">Caixa Atual</h3>
                        <p id="caixa-atual" class="text-2xl font-bold">R$ 0,00</p>
                    </div>
                    <div class="bg-white/90 p-4 rounded-lg shadow">
                        <h3 class="text-lg font-semibold text-accent-brown">Total de Vendas</h3>
                        <p id="total-vendas" class="text-2xl font-bold">R$ 0,00</p>
                    </div>
                    <div class="bg-white/90 p-4 rounded-lg shadow">
                        <h3 class="text-lg font-semibold text-accent-brown">Custos Totais</h3>
                        <p id="custos-totais" class="text-2xl font-bold">R$ 0,00</p>
                    </div>
                    <div class="bg-white/90 p-4 rounded-lg shadow">
                        <h3 class="text-lg font-semibold text-green-700">Lucro Total</h3>
                        <p id="lucro-total" class="text-2xl font-bold text-green-600">R$ 0,00</p>
                    </div>
                </div>
                 <div class="mt-6">
                    <button data-modal-target="entradaModal" class="btn-primary px-4 py-2 rounded-lg">Adicionar Entrada</button>
                    <button data-modal-target="retiradaModal" class="bg-red-500 text-white px-4 py-2 rounded-lg ml-2">Registrar Retirada</button>
                </div>
            </div>
        </main>
    </div>

    <div id="vendaModal" class="modal fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg p-8 w-full max-w-md">
            <h3 id="venda-modal-title" class="text-xl font-bold mb-4">Nova Venda</h3>
            <form id="venda-form">
                <input type="hidden" id="venda-edit-id">
                <input type="hidden" id="venda-old-total">
                <input type="hidden" id="venda-old-pagamento">
                <input id="venda-data" class="w-full p-2 mb-4 border rounded input-field" type="date" required>
                <input id="venda-cliente" class="w-full p-2 mb-4 border rounded input-field" type="text" placeholder="Nome do Cliente" required>
                <input id="venda-quantidade" class="w-full p-2 mb-4 border rounded input-field" type="number" placeholder="Quantidade de Brownies" required>
                <input id="venda-preco-unidade" class="w-full p-2 mb-4 border rounded input-field" type="number" step="0.01" placeholder="Preço por Unidade (R$)" required>
                <select id="venda-pagamento" class="w-full p-2 mb-4 border rounded input-field">
                    <option value="Dinheiro">Dinheiro</option>
                    <option value="Pix">Pix</option>
                    <option value="A Prazo">A Prazo</option>
                </select>
                <div class="flex justify-end gap-4">
                    <button type="button" data-modal-close="vendaModal" class="px-4 py-2 rounded">Cancelar</button>
                    <button type="submit" class="btn-primary px-4 py-2 rounded">Salvar</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="compraModal" class="modal fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg p-8 w-full max-w-md">
            <h3 id="compra-modal-title" class="text-xl font-bold mb-4">Nova Compra</h3>
            <form id="compra-form">
                <input type="hidden" id="compra-edit-id">
                <input type="hidden" id="compra-old-price">
                <input id="compra-data" class="w-full p-2 mb-4 border rounded input-field" type="date" required>
                <input id="compra-produto" class="w-full p-2 mb-4 border rounded input-field" type="text" placeholder="Nome do Produto (ex: Chocolate, Ovos)" required>
                <input id="compra-preco" class="w-full p-2 mb-4 border rounded input-field" type="number" step="0.01" placeholder="Preço Total Pago (R$)" required>
                <div class="flex gap-4">
                    <input id="compra-quantidade" class="w-full p-2 mb-4 border rounded input-field" type="number" step="0.01" placeholder="Qtd Total" required>
                    <select id="compra-unidade" class="w-1/2 p-2 mb-4 border rounded input-field" required>
                        <option value="g">g (gramas)</option>
                        <option value="un">un (unidades)</option>
                    </select>
                </div>
                <div class="flex justify-end gap-4">
                    <button type="button" data-modal-close="compraModal" class="px-4 py-2 rounded">Cancelar</button>
                    <button type="submit" class="btn-primary px-4 py-2 rounded">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="producaoModal" class="modal fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 overflow-y-auto">
        <div class="bg-white rounded-lg p-8 w-full max-w-lg my-8">
            <h3 id="producao-modal-title" class="text-xl font-bold mb-4">Nova Produção</h3>
            <form id="producao-form">
                <input type="hidden" id="producao-edit-id">
                <input type="hidden" id="producao-old-cost">
                <input id="producao-data" class="w-full p-2 mb-4 border rounded input-field" type="date" required>
                <input id="producao-nome" class="w-full p-2 mb-4 border rounded input-field" type="text" placeholder="Nome da Produção (ex: Fornada de Sábado)" required>
                <h4 class="font-semibold mb-2">Ingredientes (quantidade usada):</h4>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                    <input id="producao-chocolate" class="w-full p-2 border rounded input-field" type="number" step="0.01" placeholder="Chocolate (g)">
                    <input id="producao-manteiga" class="w-full p-2 border rounded input-field" type="number" step="0.01" placeholder="Manteiga (g)">
                    <input id="producao-acucar" class="w-full p-2 border rounded input-field" type="number" step="0.01" placeholder="Açúcar (g)">
                    <input id="producao-farinha" class="w-full p-2 border rounded input-field" type="number" step="0.01" placeholder="Farinha (g)">
                    <input id="producao-ovos" class="w-full p-2 border rounded input-field" type="number" step="1" placeholder="Ovos (un)">
                    <input id="producao-embalagem" class="w-full p-2 border rounded input-field" type="number" step="1" placeholder="Embalagens (un)">
                </div>
                 <h4 class="font-semibold mb-2">Custos Adicionais (valor em R$):</h4>
                 <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                    <input id="producao-recheio" class="w-full p-2 border rounded input-field" type="number" step="0.01" placeholder="Custo Recheio (total)">
                    <input id="producao-outro" class="w-full p-2 border rounded input-field" type="number" step="0.01" placeholder="Outros Custos (R$)">
                </div>
                 <h4 class="font-semibold mb-2">Resultado da Produção:</h4>
                 <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                    <input id="producao-feitos" class="w-full p-2 border rounded input-field" type="number" step="1" placeholder="Brownies Feitos (un)" required>
                    <input id="producao-perdidos" class="w-full p-2 border rounded input-field" type="number" step="1" placeholder="Brownies Perdidos (un)" value="0">
                </div>
                 <input id="producao-preco-venda" class="w-full p-2 mb-4 border rounded input-field" type="number" step="0.01" placeholder="Preço de Venda (un)" required>
                <div class="flex justify-end gap-4">
                    <button type="button" data-modal-close="producaoModal" class="px-4 py-2 rounded">Cancelar</button>
                    <button type="submit" class="btn-primary px-4 py-2 rounded">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="entradaModal" class="modal fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg p-8 w-full max-w-sm">
            <h3 class="text-xl font-bold mb-4">Adicionar Entrada no Caixa</h3>
            <form id="entrada-form">
                <input id="entrada-valor" class="w-full p-2 mb-4 border rounded input-field" type="number" step="0.01" placeholder="Valor da Entrada" required>
                <div class="flex justify-end gap-4">
                    <button type="button" data-modal-close="entradaModal" class="px-4 py-2 rounded">Cancelar</button>
                    <button type="submit" class="btn-primary px-4 py-2 rounded">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="retiradaModal" class="modal fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg p-8 w-full max-w-sm">
            <h3 class="text-xl font-bold mb-4">Registrar Retirada do Caixa</h3>
            <form id="retirada-form">
                <input id="retirada-valor" class="w-full p-2 mb-4 border rounded input-field" type="number" step="0.01" placeholder="Valor da Retirada" required>
                <div class="flex justify-end gap-4">
                    <button type="button" data-modal-close="retiradaModal" class="px-4 py-2 rounded">Cancelar</button>
                    <button type="submit" class="bg-red-500 text-white px-4 py-2 rounded">Salvar</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="confirmDeleteModal" class="modal fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg p-8 w-full max-w-sm text-center">
            <h3 class="text-xl font-bold mb-4">Confirmar Exclusão</h3>
            <p>Você tem certeza que deseja excluir este item? Esta ação não pode ser desfeita.</p>
            <div class="flex justify-center gap-4 mt-6">
                <button type="button" data-modal-close="confirmDeleteModal" class="px-4 py-2 rounded">Cancelar</button>
                <button id="confirm-delete-btn" type="button" class="bg-red-500 text-white px-4 py-2 rounded">Excluir</button>
            </div>
        </div>
    </div>


    <script type="module">
        // Importe as funções do Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, updateDoc, where, getDocs, writeBatch } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
     
        // =================================================================================
        // ATENÇÃO: Substitua o objeto abaixo pelas suas próprias credenciais do Firebase.
        // Crie um projeto novo em https://console.firebase.google.com/
        // =================================================================================
        const firebaseConfig = {
          apiKey: "SEU_API_KEY",
          authDomain: "SEU_AUTH_DOMAIN",
          projectId: "SEU_PROJECT_ID",
          storageBucket: "SEU_STORAGE_BUCKET",
          messagingSenderId: "SEU_MESSAGING_SENDER_ID",
          appId: "SEU_APP_ID"
        };
     
        // Inicializa o Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Variável para guardar o ID do usuário
        let userId;

        // --- LÓGICA DE AUTENTICAÇÃO ANÔNIMA E INICIALIZAÇÃO ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Usuário está logado, guardamos o UID dele
                userId = user.uid;
                initializeAppLogic();
            } else {
                // Usuário não está logado, faz o login anônimo
                signInAnonymously(auth).catch((error) => {
                    console.error("Falha no login anônimo:", error);
                    alert("Não foi possível conectar ao banco de dados. Por favor, recarregue a página.");
                });
            }
        });

        function initializeAppLogic() {
            // Só executa a lógica do app depois de ter o userId
            if (!userId) return;
            
            loadFinanceiroData(); 
            listenToCompras();
            listenToProducao();
            listenToVendas();
            setupEventListeners();
        }

        // --- LÓGICA FINANCEIRA ---
        let financeiro = { caixa: 0, vendas: 0, custos: 0 };
        const getFinanceiroDocRef = () => doc(db, "users", userId, "financeiro", "summary");

        async function loadFinanceiroData() {
            const docSnap = await getDoc(getFinanceiroDocRef());
            if (docSnap.exists()) {
                financeiro = docSnap.data();
            } else {
                // Se não existe, cria o documento inicial
                await setDoc(getFinanceiroDocRef(), financeiro);
            }
            updateFinanceiroUI();
        }

        async function saveFinanceiroData() {
            await setDoc(getFinanceiroDocRef(), financeiro);
        }
        
        function formatCurrency(value) {
            if (typeof value !== 'number') return 'R$ 0,00';
            return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }
        
        function formatCostPerUnit(value, unit) {
            if (typeof value !== 'number' || !isFinite(value)) return 'R$ 0,00';
             return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL', minimumFractionDigits: 4 }) + ` / ${unit}`;
        }

        function updateFinanceiroUI() {
            const lucro = financeiro.vendas - financeiro.custos;
            document.getElementById('caixa-atual').textContent = formatCurrency(financeiro.caixa);
            document.getElementById('total-vendas').textContent = formatCurrency(financeiro.vendas);
            document.getElementById('custos-totais').textContent = formatCurrency(financeiro.custos);
            document.getElementById('lucro-total').textContent = formatCurrency(lucro);
        }
        
        document.getElementById('entrada-form').addEventListener('submit', async function(event) {
            event.preventDefault();
            const valor = parseFloat(document.getElementById('entrada-valor').value);
            if (!isNaN(valor)) {
                financeiro.caixa += valor;
                await saveFinanceiroData();
                updateFinanceiroUI();
                closeModal('entradaModal');
            }
        });

        document.getElementById('retirada-form').addEventListener('submit', async function(event) {
            event.preventDefault();
            const valor = parseFloat(document.getElementById('retirada-valor').value);
            if (!isNaN(valor)) {
                financeiro.caixa -= valor;
                await saveFinanceiroData();
                updateFinanceiroUI();
                closeModal('retiradaModal');
            }
        });

        // --- LÓGICA DE COMPRAS ---
        const compraForm = document.getElementById('compra-form');
        const getComprasCollectionRef = () => collection(db, "users", userId, "compras");

        compraForm.addEventListener('submit', async (event) => {
            event.preventDefault(); 
            const preco = parseFloat(document.getElementById('compra-preco').value);
            const quantidade = parseFloat(document.getElementById('compra-quantidade').value);
            const custoPorUnidade = (quantidade > 0) ? preco / quantidade : 0;
            const editId = document.getElementById('compra-edit-id').value;

            const data = {
                data: document.getElementById('compra-data').value,
                produto: document.getElementById('compra-produto').value,
                precoTotal: preco,
                quantidadeTotal: quantidade,
                unidade: document.getElementById('compra-unidade').value,
                custoPorUnidade: custoPorUnidade
            };

            try {
                if (editId) {
                    const oldPrice = parseFloat(document.getElementById('compra-old-price').value);
                    const docRef = doc(db, "users", userId, "compras", editId);
                    await updateDoc(docRef, data);
                    financeiro.custos = (financeiro.custos - oldPrice) + preco;
                } else {
                    await addDoc(getComprasCollectionRef(), data);
                    financeiro.custos += preco;
                }
                
                await saveFinanceiroData();
                updateFinanceiroUI();
                closeModal('compraModal');
            } catch (e) {
                console.error("Erro ao salvar compra: ", e);
                alert("Ocorreu um erro ao salvar a compra.");
            }
        });

        function listenToCompras() {
            const q = query(getComprasCollectionRef(), orderBy("data", "desc"));
            onSnapshot(q, (snapshot) => {
                const comprasTableBody = document.getElementById('compras-table-body');
                let comprasHtml = '';
                snapshot.forEach((doc) => {
                    const compra = doc.data();
                    const docId = doc.id;
                    comprasHtml += `
                        <tr class="border-b border-gray-200">
                            <td class="p-3">${new Date(compra.data + 'T00:00:00').toLocaleDateString('pt-BR')}</td>
                            <td class="p-3">${compra.produto}</td>
                            <td class="p-3">${formatCostPerUnit(compra.custoPorUnidade, compra.unidade)}</td>
                            <td class="p-3">${formatCurrency(compra.precoTotal)}</td>
                            <td class="p-3 flex gap-2">
                                <button class="action-btn" data-action="edit" data-collection="compras" data-id="${docId}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16" style="pointer-events: none;"><path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/><path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"/></svg>
                                </button>
                                <button class="action-btn" data-action="delete" data-collection="compras" data-id="${docId}" data-cost="${compra.precoTotal}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="text-red-500" viewBox="0 0 16 16" style="pointer-events: none;"><path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/><path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/></svg>
                                </button>
                            </td>
                        </tr>
                    `;
                });
                comprasTableBody.innerHTML = comprasHtml;
            });
        }
        
        async function openCompraEditModal(id) {
            const docRef = doc(db, "users", userId, "compras", id);
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) {
                const data = docSnap.data();
                document.getElementById('compra-modal-title').innerText = "Editar Compra";
                document.getElementById('compra-edit-id').value = id;
                document.getElementById('compra-old-price').value = data.precoTotal;
                document.getElementById('compra-data').value = data.data;
                document.getElementById('compra-produto').value = data.produto;
                document.getElementById('compra-preco').value = data.precoTotal;
                document.getElementById('compra-quantidade').value = data.quantidadeTotal;
                document.getElementById('compra-unidade').value = data.unidade;
                openModal('compraModal');
            }
        }

        // --- LÓGICA DE PRODUÇÃO ---
        const producaoForm = document.getElementById('producao-form');
        const getProducaoCollectionRef = () => collection(db, "users", userId, "producao");
        
        const INGREDIENTES_MAP = {
            chocolate: { queryName: 'Chocolate', id: 'producao-chocolate' },
            manteiga:  { queryName: 'Manteiga',  id: 'producao-manteiga' },
            acucar:    { queryName: 'Açúcar',    id: 'producao-acucar' },
            farinha:   { queryName: 'Farinha',   id: 'producao-farinha' },
            ovos:      { queryName: 'Ovos',      id: 'producao-ovos' },
            embalagem: { queryName: 'Embalagem', id: 'producao-embalagem' }
        };

        async function getCustoIngrediente(nome, qtdUsada) {
            if (!nome || !qtdUsada || qtdUsada <= 0) return 0;
            const q = query(getComprasCollectionRef(), where("produto", "==", nome), orderBy("data", "desc"));
            const querySnapshot = await getDocs(q);

            if (querySnapshot.empty) {
                 alert(`Atenção: Não foi encontrada uma compra para "${nome}" para calcular o custo. O valor será zero.`);
                 return 0;
            }
            
            // Pega a compra mais recente para o cálculo de custo
            const compraRecente = querySnapshot.docs[0].data();
            return compraRecente.custoPorUnidade * qtdUsada;
        }

        producaoForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const editId = document.getElementById('producao-edit-id').value;
            
            let custoIngredientes = 0;
            const ingredientesUsados = [];

            for (const key in INGREDIENTES_MAP) {
                const ing = INGREDIENTES_MAP[key];
                const qtd = parseFloat(document.getElementById(ing.id).value) || 0;
                if (qtd > 0) {
                    const custo = await getCustoIngrediente(ing.queryName, qtd);
                    custoIngredientes += custo;
                    ingredientesUsados.push({ nome: key, qtd: qtd, queryName: ing.queryName });
                }
            }
            
            const browniesFeitos = parseInt(document.getElementById('producao-feitos').value) || 0;
            const custoRecheio = parseFloat(document.getElementById('producao-recheio').value) || 0;
            const custoOutro = parseFloat(document.getElementById('producao-outro').value) || 0;
            const custoTotalProducao = custoIngredientes + custoRecheio + custoOutro;
            const custoUnitario = (browniesFeitos > 0) ? custoTotalProducao / browniesFeitos : 0;

            const data = {
                data: document.getElementById('producao-data').value,
                nome: document.getElementById('producao-nome').value,
                precoVenda: parseFloat(document.getElementById('producao-preco-venda').value),
                perdidos: parseInt(document.getElementById('producao-perdidos').value) || 0,
                custoUnitario: custoUnitario,
                custoTotal: custoTotalProducao,
                browniesFeitos: browniesFeitos,
                ingredientesUsados: ingredientesUsados,
                custosAdicionais: { recheio: custoRecheio, outro: custoOutro }
            };

            try {
                if (editId) {
                    const oldCost = parseFloat(document.getElementById('producao-old-cost').value);
                    const docRef = doc(db, "users", userId, "producao", editId);
                    await updateDoc(docRef, data);
                    financeiro.custos = (financeiro.custos - oldCost) + custoTotalProducao;
                } else {
                    await addDoc(getProducaoCollectionRef(), data);
                    financeiro.custos += custoTotalProducao;
                }
                
                await saveFinanceiroData();
                updateFinanceiroUI();
                closeModal('producaoModal');
            } catch(e) {
                console.error("Erro ao salvar produção: ", e);
                alert("Ocorreu um erro ao salvar a produção.");
            }
        });

        function listenToProducao() {
            const q = query(getProducaoCollectionRef(), orderBy("data", "desc"));
            onSnapshot(q, (snapshot) => {
                const producaoTableBody = document.getElementById('producao-table-body');
                let producaoHtml = '';
                const producoes = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                producoes.forEach((p) => {
                    producaoHtml += `
                        <tr class="border-b border-gray-200">
                            <td class="p-3">${new Date(p.data + 'T00:00:00').toLocaleDateString('pt-BR')}</td>
                            <td class="p-3">${p.nome}</td>
                            <td class="p-3">${p.browniesFeitos}</td>
                            <td class="p-3">${formatCurrency(p.custoUnitario)}</td>
                            <td class="p-3">${formatCurrency(p.precoVenda)}</td>
                            <td class="p-3">${p.perdidos}</td>
                            <td class="p-3 flex gap-2">
                                <button class="action-btn" data-action="edit" data-collection="producao" data-id="${p.id}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16" style="pointer-events: none;"><path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/><path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"/></svg>
                                </button>
                                <button class="action-btn" data-action="delete" data-collection="producao" data-id="${p.id}" data-cost="${p.custoTotal}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="text-red-500" viewBox="0 0 16 16" style="pointer-events: none;"><path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/><path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/></svg>
                                </button>
                            </td>
                        </tr>
                    `;
                });
                producaoTableBody.innerHTML = producaoHtml;
            });
        }
        
        async function openProducaoEditModal(id) {
            const docRef = doc(db, "users", userId, "producao", id);
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) {
                const p = docSnap.data();
                document.getElementById('producao-modal-title').innerText = "Editar Produção";
                document.getElementById('producao-edit-id').value = id;
                document.getElementById('producao-old-cost').value = p.custoTotal;
                document.getElementById('producao-data').value = p.data;
                document.getElementById('producao-nome').value = p.nome;
                p.ingredientesUsados.forEach(ing => {
                    const ingMap = INGREDIENTES_MAP[ing.nome];
                    if(ingMap) {
                        const el = document.getElementById(ingMap.id);
                        if (el) el.value = ing.qtd;
                    }
                });
                document.getElementById('producao-recheio').value = p.custosAdicionais.recheio || '';
                document.getElementById('producao-outro').value = p.custosAdicionais.outro || '';
                document.getElementById('producao-feitos').value = p.browniesFeitos;
                document.getElementById('producao-preco-venda').value = p.precoVenda;
                document.getElementById('producao-perdidos').value = p.perdidos;
                openModal('producaoModal');
            }
        };

        // --- LÓGICA DE VENDAS ---
        const vendaForm = document.getElementById('venda-form');
        const getVendasCollectionRef = () => collection(db, "users", userId, "vendas");

        vendaForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const total = parseFloat(document.getElementById('venda-quantidade').value) * parseFloat(document.getElementById('venda-preco-unidade').value);
            const pagamento = document.getElementById('venda-pagamento').value;
            const editId = document.getElementById('venda-edit-id').value;

            const data = {
                data: document.getElementById('venda-data').value,
                cliente: document.getElementById('venda-cliente').value,
                quantidade: parseFloat(document.getElementById('venda-quantidade').value),
                precoUnidade: parseFloat(document.getElementById('venda-preco-unidade').value),
                pagamento: pagamento,
                total: total
            };

            try {
                if (editId) {
                    const oldTotal = parseFloat(document.getElementById('venda-old-total').value);
                    const oldPagamento = document.getElementById('venda-old-pagamento').value;
                    
                    financeiro.vendas -= oldTotal;
                    if (oldPagamento !== 'A Prazo') financeiro.caixa -= oldTotal;

                    financeiro.vendas += total;
                    if (pagamento !== 'A Prazo') financeiro.caixa += total;
                    
                    const docRef = doc(db, "users", userId, "vendas", editId);
                    await updateDoc(docRef, data);

                } else {
                    await addDoc(getVendasCollectionRef(), data);
                    financeiro.vendas += total;
                    if (pagamento !== 'A Prazo') {
                        financeiro.caixa += total;
                    }
                }
                
                await saveFinanceiroData();
                updateFinanceiroUI();
                closeModal('vendaModal');
            } catch (e) {
                console.error("Erro ao salvar venda: ", e);
                alert("Ocorreu um erro ao salvar a venda.");
            }
        });

        function listenToVendas() {
            const q = query(getVendasCollectionRef(), orderBy("data", "desc"));
            onSnapshot(q, (snapshot) => {
                const vendasTableBody = document.getElementById('vendas-table-body');
                let vendasHtml = '';
                const vendas = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                vendas.forEach((v) => {
                    vendasHtml += `
                        <tr class="border-b border-gray-200">
                            <td class="p-3">${new Date(v.data + 'T00:00:00').toLocaleDateString('pt-BR')}</td>
                            <td class="p-3">${v.cliente}</td>
                            <td class="p-3">${v.quantidade}</td>
                            <td class="p-3">${v.pagamento}</td>
                            <td class="p-3">${formatCurrency(v.total)}</td>
                            <td class="p-3 flex gap-2">
                                <button class="action-btn" data-action="edit" data-collection="vendas" data-id="${v.id}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16" style="pointer-events: none;"><path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/><path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"/></svg>
                                </button>
                                <button class="action-btn" data-action="delete" data-collection="vendas" data-id="${v.id}" data-total-venda="${v.total}" data-pagamento="${v.pagamento}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="text-red-500" viewBox="0 0 16 16" style="pointer-events: none;"><path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/><path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/></svg>
                                </button>
                            </td>
                        </tr>
                    `;
                });
                vendasTableBody.innerHTML = vendasHtml;

                // Após renderizar a tabela de vendas, atualiza o estoque e a aba "A Prazo"
                updateEstoqueAndAPrazo();
            });
        }
        
        async function openVendaEditModal(id) {
            const docRef = doc(db, "users", userId, "vendas", id);
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) {
                const v = docSnap.data();
                document.getElementById('venda-modal-title').innerText = "Editar Venda";
                document.getElementById('venda-edit-id').value = id;
                document.getElementById('venda-old-total').value = v.total;
                document.getElementById('venda-old-pagamento').value = v.pagamento;
                document.getElementById('venda-data').value = v.data;
                document.getElementById('venda-cliente').value = v.cliente;
                document.getElementById('venda-quantidade').value = v.quantidade;
                document.getElementById('venda-preco-unidade').value = v.precoUnidade;
                document.getElementById('venda-pagamento').value = v.pagamento;
                openModal('vendaModal');
            }
        };

        // --- LÓGICA DE ESTOQUE E A PRAZO (COMBINADA PARA EFICIÊNCIA) ---
        async function updateEstoqueAndAPrazo() {
            // Pega todos os dados de produção e vendas de uma vez
            const producaoSnapshot = await getDocs(getProducaoCollectionRef());
            const vendasSnapshot = await getDocs(getVendasCollectionRef());

            // --- Lógica de Estoque ---
            let totalProduzido = 0;
            let totalPerdido = 0;
            const producoes = [];
            producaoSnapshot.forEach(doc => {
                const p = doc.data();
                totalProduzido += p.browniesFeitos;
                totalPerdido += p.perdidos;
                producoes.push(p);
            });

            let totalVendido = 0;
            vendasSnapshot.forEach(doc => {
                totalVendido += doc.data().quantidade;
            });

            const estoqueAtual = totalProduzido - totalVendido;
            document.getElementById('estoque-total').innerText = estoqueAtual;

            let estoqueHtml = '';
            producoes.sort((a,b) => new Date(b.data) - new Date(a.data)).forEach(p => {
                 estoqueHtml += `
                    <tr class="border-b border-gray-200">
                        <td class="p-3">${new Date(p.data + 'T00:00:00').toLocaleDateString('pt-BR')}</td>
                        <td class="p-3">${p.nome}</td>
                        <td class="p-3">${p.browniesFeitos - p.perdidos}</td>
                    </tr>
                `;
            });
            document.getElementById('estoque-table-body').innerHTML = estoqueHtml;

            // --- Lógica "A Prazo" ---
            const aPrazo = {};
            vendasSnapshot.forEach(doc => {
                const v = doc.data();
                if (v.pagamento === 'A Prazo') {
                    if (!aPrazo[v.cliente]) {
                        aPrazo[v.cliente] = 0;
                    }
                    aPrazo[v.cliente] += v.total;
                }
            });

            const aprazoTableBody = document.getElementById('aprazo-table-body');
            let aprazoHtml = '';
            for (const cliente in aPrazo) {
                aprazoHtml += `
                    <tr class="border-b border-gray-200">
                        <td class="p-3">${cliente}</td>
                        <td class="p-3">${formatCurrency(aPrazo[cliente])}</td>
                    </tr>
                `;
            }
            aprazoTableBody.innerHTML = aprazoHtml;
        }

        // --- LÓGICA DE EXCLUSÃO ---
        const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
        let deleteInfo = {};

        function requestDelete(info) {
            deleteInfo = info;
            openModal('confirmDeleteModal');
        };

        confirmDeleteBtn.addEventListener('click', async () => {
            const { collectionName, docId, cost, totalVenda, pagamento } = deleteInfo;
            if (!collectionName || !docId) return;

            try {
                await deleteDoc(doc(db, "users", userId, collectionName, docId));
                if (cost) { // Exclusão de compra ou produção
                    financeiro.custos -= cost;
                }
                if (totalVenda) { // Exclusão de venda
                    financeiro.vendas -= totalVenda;
                    if (pagamento !== 'A Prazo') {
                        financeiro.caixa -= totalVenda;
                    }
                }
                await saveFinanceiroData();
                updateFinanceiroUI();
                closeModal('confirmDeleteModal');
            } catch (e) {
                console.error("Erro ao excluir: ", e);
                alert("Ocorreu um erro ao excluir o item.");
            }
        });

        // --- LÓGICA GERAL (ABAS, MODAIS, EVENTOS) ---
        function openTab(tabName) {
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.add('hidden'));
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            document.getElementById(tabName).classList.remove('hidden');
            document.querySelector(`.tab-button[data-tab="${tabName}"]`).classList.add('active');
        }

        function openModal(modalId) {
            // Limpa formulários ao abrir
            const formIds = {
                'vendaModal': 'venda-form', 'compraModal': 'compra-form',
                'producaoModal': 'producao-form', 'entradaModal': 'entrada-form',
                'retiradaModal': 'retirada-form'
            };
            if (formIds[modalId]) {
                const form = document.getElementById(formIds[modalId]);
                form.reset();
                // Define data atual para campos de data
                const dateInput = form.querySelector('input[type="date"]');
                if (dateInput) {
                    dateInput.value = new Date().toISOString().split('T')[0];
                }
            }

            // Reseta títulos e IDs de edição
            const titles = {
                'compraModal': 'compra-modal-title', 'producaoModal': 'producao-modal-title', 'vendaModal': 'venda-modal-title'
            };
            const editIds = {
                'compraModal': 'compra-edit-id', 'producaoModal': 'producao-edit-id', 'vendaModal': 'venda-edit-id'
            };
            if(titles[modalId]) {
                document.getElementById(titles[modalId]).innerText = titles[modalId].includes('venda') ? "Nova Venda" : (titles[modalId].includes('compra') ? "Nova Compra" : "Nova Produção");
                document.getElementById(editIds[modalId]).value = '';
            }
            
            const modal = document.getElementById(modalId);
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        function setupEventListeners() {
            // Navegação por Abas
            document.querySelector('.flex.flex-wrap.justify-center').addEventListener('click', (event) => {
                if (event.target.matches('.tab-button')) {
                    openTab(event.target.dataset.tab);
                }
            });

            // Abrir Modais
            document.querySelectorAll('[data-modal-target]').forEach(button => {
                button.addEventListener('click', () => {
                    openModal(button.dataset.modalTarget);
                });
            });

            // Fechar Modais (botão cancelar e clique fora)
            document.body.addEventListener('click', (event) => {
                if (event.target.hasAttribute('data-modal-close')) {
                    closeModal(event.target.dataset.modalClose);
                }
                if (event.target.matches('.modal')) {
                    closeModal(event.target.id);
                }
            });

            // Event Delegation para botões de Editar e Excluir
            document.getElementById('tab-content').addEventListener('click', async (event) => {
                const button = event.target.closest('.action-btn');
                if (!button) return;

                const { action, collection, id } = button.dataset;

                if (action === 'edit') {
                    if (collection === 'compras') await openCompraEditModal(id);
                    if (collection === 'producao') await openProducaoEditModal(id);
                    if (collection === 'vendas') await openVendaEditModal(id);
                } else if (action === 'delete') {
                    const deleteData = {
                        collectionName: collection,
                        docId: id,
                        cost: parseFloat(button.dataset.cost) || null,
                        totalVenda: parseFloat(button.dataset.totalVenda) || null,
                        pagamento: button.dataset.pagamento || null
                    };
                    requestDelete(deleteData);
                }
            });
        }
    </script>
</body>
</html>
